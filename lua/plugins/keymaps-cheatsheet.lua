-- lua/plugins/keymaps-cheatsheet.lua
-- Cheat sheet visual de todos los mapeos de teclado

return {
	{
		"nvim-lua/plenary.nvim",
		config = function()
			-- ========== FUNCIรN PARA MOSTRAR CHEAT SHEET ==========
			local function show_keymaps_cheatsheet()
				local keymaps_content = [[
๐ฏ NEOVIM - CHEAT SHEET DE MAPEOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ EJECUCIรN DE CรDIGO (MรS IMPORTANTE)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ F9              ๐ฏ Ejecutar archivo actual (universal)             โ
โ F10             โ๏ธ Ejecutar con argumentos                         โ
โ Shift+Enter     ๐ Ejecutar archivo (alternativo)                  โ
โ <leader>dr      ๐ฏ Debug: Ejecutar archivo                         โ
โ <leader>da      โ๏ธ Debug: Ejecutar con argumentos                  โ
โ <leader>ds      ๐ Debug: Ejecutar selecciรณn (visual)              โ
โ <leader>dc      ๐งน Limpiar terminales de debug                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DEBUGGING AVANZADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Ctrl+C          ๐ Iniciar debugging inteligente                   โ
โ F5              โถ๏ธ Continuar debugging                              โ
โ F10             โญ Step Over (en debug mode)                       โ
โ F11             โฌ Step Into                                        โ
โ F12             โฎ Step Out                                         โ
โ <leader>b       ๐ด Toggle Breakpoint                              โ
โ <leader>B       โ Breakpoint Condicional                         โ
โ <leader>dt      โน Terminar Debug                                  โ
โ <leader>du      ๐ฅ๏ธ Toggle Debug UI                                โ
โ <leader>dr      ๐ Abrir REPL                                     โ
โ <leader>dv      ๐ Evaluar expresiรณn                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐พ SISTEMA BรSICO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ F2              ๐พ Guardar archivo                                 โ
โ F3              โ Cerrar ventana                                   โ
โ F4              ๐พโ Guardar y salir                                โ
โ Tab             โก๏ธ Siguiente buffer                                โ
โ Shift+Tab       โฌ๏ธ Buffer anterior / Des-indentar                 โ
โ Ctrl+V          ๐ Pegar desde portapapeles                        โ
โ Ctrl+P          ๐ Buscar archivos (Telescope)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ง REFACTORING (Rope - Para cรณdigo limpio)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ <leader>rr      ๐ Renombrar variable en proyecto                  โ
โ <leader>rf      ๐ Extraer funciรณn (selecciรณn)                     โ
โ <leader>rv      ๐ Extraer variable                                โ
โ <leader>ri      โฉ๏ธ Inline variable                                 โ
โ <leader>ro      ๐ Organizar imports                               โ
โ <leader>rk      ๐ง Extraer constante                               โ
โ <leader>rp      ๐ Agregar print debug                             โ
โ <leader>rc      ๐งน Limpiar debug prints                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ SERVIDOR WEB (Para desarrollo web)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ <leader>ws      ๐ Iniciar servidor web / Bracey                   โ
โ <leader>wl      ๐ Live Server (auto-reload)                       โ
โ <leader>wb      ๐ Abrir en navegador                              โ
โ <leader>wo      ๐ Abrir archivo en navegador                      โ
โ <leader>wx      โน๏ธ Detener todos los servidores                    โ
โ <leader>ps      ๐ Servidor Python HTTP                           โ
โ F6              ๐ Servidor web (alternativo)                      โ
โ F7              ๐ Abrir en navegador (alternativo)                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ NAVEGACIรN Y LSP
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ K               ๐ Documentaciรณn hover                             โ
โ gd              ๐ฏ Ir a definiciรณn                                 โ
โ gD              ๐ Ir a declaraciรณn                                โ
โ gi              ๐ Ir a implementaciรณn                             โ
โ Ctrl+K          ๐ Signature help                                  โ
โ [d              โฌ๏ธ Diagnรณstico anterior                            โ
โ ]d              โฌ๏ธ Diagnรณstico siguiente                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ FORMATEO Y PRODUCTIVIDAD
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ <leader>f       ๐จ Formatear cรณdigo                                โ
โ Ctrl+J          ๐จ Formatear cรณdigo (alternativo)                  โ
โ <leader>rr      ๐ Recargar LSP y Treesitter                      โ
โ <leader>ld      ๐ Diagnosticar estado LSP                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ค AUTOCOMPLETADO INTELIGENTE (CODEIUM + LSP)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Tab             โฌ๏ธ Siguiente sugerencia en menรบ                     โ
โ Shift+Tab       โฌ๏ธ Sugerencia anterior en menรบ                     โ
โ Enter           โ Aceptar sugerencia seleccionada                 โ
โ Ctrl+Space      ๐ Mostrar autocompletado manual                   โ
โ Ctrl+E          โ Cerrar menรบ autocompletado                      โ
โ Enter           โ Confirmar selecciรณn                             โ
โ Ctrl+J          โฌ๏ธ Siguiente opciรณn (CMP)                          โ
โ Ctrl+K          โฌ๏ธ Opciรณn anterior (CMP)                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ INDENTACIรN INTELIGENTE
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Enter           โฉ๏ธ Nueva lรญnea con indentaciรณn inteligente         โ
โ Tab             โก๏ธ Indentar (al inicio de lรญnea)                  โ
โ Shift+Tab       โฌ๏ธ Des-indentar/retroceder nivel                  โ
โ Alt+K           ๐ Expandir/saltar snippet                         โ
โ Alt+J           โฉ๏ธ Saltar atrรกs en snippet                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ฏ LENGUAJES ESPECรFICOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ PHP:                                                                โ
โ <leader>dd      ๐ Verificar sintaxis PHP                          โ
โ <leader>db      ๐ Ejecutar archivo PHP                            โ
โ                                                                     โ
โ MySQL/SQL:                                                          โ
โ <leader>ds      ๐๏ธ Ejecutar consulta MySQL                         โ
โ                                                                     โ
โ Java (si habilitado):                                               โ
โ <leader>jo      ๐ Organizar imports Java                          โ
โ <leader>jr      โ Compilar y ejecutar Java                        โ
โ <leader>jc      ๐ง Compilar Java                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โญ COMANDOS รTILES
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ :Cheat          ๐ Mostrar este cheat sheet                        โ
โ :DebugHelp      ๐ Ayuda de debugging                              โ
โ :RefactorHelp   ๐ง Ayuda de refactoring                            โ
โ :WebHelp        ๐ Ayuda de servidor web                           โ
โ :SmartIndentHelp ๐ Ayuda de indentaciรณn                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ก TIPS IMPORTANTES:
โโ Leader Key = ESPACIO (Space)
โโ F9 es tu mejor amigo (ejecuta cualquier archivo)
โโ Ctrl+C para debugging con breakpoints
โโ <leader>ws para servidor web rรกpido
โโ <leader>rr para renombrar variables en todo el proyecto
โโ Flechas โโโโ estรกn desactivadas (usa hjkl como un pro)

๐ FLUJO TรPICO DE AUTOMATIZACIรN:
1๏ธโฃ Abre tu script.py
2๏ธโฃ F9 para probar rรกpido
3๏ธโฃ Ctrl+C para debugging si hay errores
4๏ธโฃ <leader>rr para renombrar variables
5๏ธโฃ <leader>ro para organizar imports
6๏ธโฃ <leader>f para formatear cรณdigo final

ยกCTRL+Q para cerrar este cheat sheet!
]]

				-- Crear buffer temporal
				local buf = vim.api.nvim_create_buf(false, true)
				local lines = vim.split(keymaps_content, "\n")
				vim.api.nvim_buf_set_lines(buf, 0, -1, false, lines)
				vim.api.nvim_buf_set_option(buf, "filetype", "help")
				vim.api.nvim_buf_set_option(buf, "buftype", "nofile")
				vim.api.nvim_buf_set_option(buf, "bufhidden", "wipe")
				vim.api.nvim_buf_set_option(buf, "swapfile", false)

				-- Abrir en ventana completa
				vim.cmd("tabnew")
				vim.api.nvim_win_set_buf(0, buf)

				-- Hacer buffer de solo lectura
				vim.api.nvim_buf_set_option(buf, "modifiable", false)
				vim.api.nvim_buf_set_option(buf, "readonly", true)

				-- Mapeo para cerrar con q o Ctrl+Q
				vim.api.nvim_buf_set_keymap(buf, "n", "q", ":q<CR>", { noremap = true, silent = true })
				vim.api.nvim_buf_set_keymap(buf, "n", "<C-q>", ":q<CR>", { noremap = true, silent = true })
				vim.api.nvim_buf_set_keymap(buf, "n", "<Esc>", ":q<CR>", { noremap = true, silent = true })

				-- Tรญtulo del buffer
				vim.api.nvim_buf_set_name(buf, "๐ฏ Neovim Cheat Sheet")

				print("๐ Cheat Sheet abierto. Presiona 'q' o Ctrl+Q para cerrar")
			end

			-- ========== FUNCIรN CHEAT SHEET COMPACTO ==========
			local function show_compact_cheatsheet()
				local compact_content = [[
๐ฏ MAPEOS ESENCIALES (Los mรกs usados):

๐ฅ EJECUTAR CรDIGO:
F9 = Ejecutar archivo | F10 = Con argumentos | Ctrl+C = Debug

๐พ BรSICOS:
F2 = Guardar | F3 = Cerrar | F4 = Guardar+Cerrar | Tab = Buffer+/-

๐ง REFACTORING:
<leader>rr = Renombrar | <leader>rf = Extraer funciรณn | <leader>ro = Organizar

๐ WEB:
<leader>ws = Servidor | <leader>wb = Navegador | F6/F7 = Alternativos

๐ NAVEGACIรN:
K = Docs | gd = Definiciรณn | Ctrl+P = Buscar archivos

โก PRODUCTIVIDAD:
<leader>f = Formatear | Ctrl+G = IA | Ctrl+Space = Autocompletado

Leader Key = ESPACIO | :Cheat = Cheat sheet completo
]]
				print(compact_content)
			end

			-- ========== FUNCIรN MAPEOS POR CATEGORรA ==========
			local function show_category_help(category)
				local categories = {
					ejecutar = [[
๐ MAPEOS DE EJECUCIรN:
F9              - Ejecutar archivo actual
F10             - Ejecutar con argumentos  
Shift+Enter     - Ejecutar archivo (alternativo)
<leader>dr      - Debug: Ejecutar archivo
<leader>da      - Debug: Ejecutar con argumentos
<leader>ds      - Debug: Ejecutar selecciรณn (visual)
<leader>dc      - Limpiar terminales de debug
]],
					debug = [[
๐ MAPEOS DE DEBUGGING:
Ctrl+C          - Iniciar debugging inteligente
F5              - Continuar debugging
F10             - Step Over (en debug mode)
F11             - Step Into
F12             - Step Out
<leader>b       - Toggle Breakpoint
<leader>B       - Breakpoint Condicional  
<leader>dt      - Terminar Debug
<leader>du      - Toggle Debug UI
]],
					refactor = [[
๐ง MAPEOS DE REFACTORING:
<leader>rr      - Renombrar variable en proyecto
<leader>rf      - Extraer funciรณn (selecciรณn)
<leader>rv      - Extraer variable
<leader>ri      - Inline variable
<leader>ro      - Organizar imports
<leader>rk      - Extraer constante
<leader>rp      - Agregar print debug
<leader>rc      - Limpiar debug prints
]],
					web = [[
๐ MAPEOS DE SERVIDOR WEB:
<leader>ws      - Iniciar servidor web / Bracey
<leader>wl      - Live Server (auto-reload)
<leader>wb      - Abrir en navegador
<leader>wo      - Abrir archivo en navegador
<leader>wx      - Detener todos los servidores
<leader>ps      - Servidor Python HTTP
F6              - Servidor web (alternativo)
F7              - Abrir en navegador (alternativo)
]],
					basico = [[
๐พ MAPEOS BรSICOS:
F2              - Guardar archivo
F3              - Cerrar ventana
F4              - Guardar y salir
Tab             - Siguiente buffer
Shift+Tab       - Buffer anterior / Des-indentar
Ctrl+V          - Pegar desde portapapeles
Ctrl+P          - Buscar archivos (Telescope)
]],
				}

				if categories[category] then
					print(categories[category])
				else
					print("Categorรญas disponibles: ejecutar, debug, refactor, web, basico")
				end
			end

			-- ========== COMANDOS VIM ==========

			-- Comando principal para cheat sheet completo
			vim.api.nvim_create_user_command("Cheat", show_keymaps_cheatsheet, {
				desc = "Mostrar cheat sheet completo de mapeos",
			})

			-- Comando para cheat sheet compacto
			vim.api.nvim_create_user_command("CheatCompact", show_compact_cheatsheet, {
				desc = "Mostrar mapeos esenciales (compacto)",
			})

			-- Comando para mostrar por categorรญas
			vim.api.nvim_create_user_command("CheatCategory", function(opts)
				show_category_help(opts.args)
			end, {
				nargs = 1,
				complete = function()
					return { "ejecutar", "debug", "refactor", "web", "basico" }
				end,
				desc = "Mostrar mapeos por categorรญa",
			})

			-- Mapeo rรกpido para cheat sheet
			vim.keymap.set("n", "<leader>?", show_keymaps_cheatsheet, {
				desc = "๐ Mostrar cheat sheet de mapeos",
				noremap = true,
				silent = true,
			})

			-- Mapeo para cheat compacto
			vim.keymap.set("n", "<leader><leader>?", show_compact_cheatsheet, {
				desc = "๐ Cheat sheet compacto",
				noremap = true,
				silent = true,
			})

			-- ========== AUTO-COMANDO AL INICIAR NEOVIM (DESACTIVADO) ==========

			-- Variable para controlar si mostrar al inicio (DESACTIVADO por defecto)
			vim.g.show_cheatsheet_on_start = false

			-- Mensaje simple al iniciar (solo si no hay archivos)
			-- vim.api.nvim_create_autocmd("VimEnter", {
			-- 	callback = function()
			-- 		-- Solo mostrar mensaje simple si no se abriรณ con archivos
			-- 		if #vim.fn.argv() == 0 then
			-- 			vim.defer_fn(function()
			-- 				print(
			-- 					"โ Neovim configurado listo. Usa :Cheat para ver mapeos o F9 para ejecutar archivos"
			-- 				)
			-- 			end, 100)
			-- 		end
			-- 	end,
			-- 	desc = "Mensaje simple al iniciar Neovim",
			-- })

			-- Comando para toggle del cheat sheet al inicio
			vim.api.nvim_create_user_command("CheatStartToggle", function()
				vim.g.show_cheatsheet_on_start = not vim.g.show_cheatsheet_on_start
				local status = vim.g.show_cheatsheet_on_start and "ACTIVADO" or "DESACTIVADO"
				print("๐ Cheat sheet al inicio: " .. status)
			end, { desc = "Toggle mostrar cheat sheet al iniciar" })

			-- print("โ Cheat Sheet configurado. Usa :Cheat o <leader>? para verlo")
		end,
	},
}
